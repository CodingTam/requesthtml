<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Management System</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .col-md-2-4 {
            position: relative;
            width: 100%;
            padding-right: 15px;
            padding-left: 15px;
        }
        @media (min-width: 768px) {
            .col-md-2-4 {
                flex: 0 0 20%;
                max-width: 20%;
            }
        }

        /* Custom Tooltip - JavaScript controlled only */
        .custom-tooltip {
            cursor: help;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row bg-primary text-white py-2 mb-3">
            <div class="col">
                <h2><i class="fas fa-clipboard-list mr-2"></i>Request Management System</h2>
                <p class="mb-0">Welcome back, <span id="current-user">User</span></p>
            </div>
            <div class="col-auto d-flex align-items-center">
                <button class="btn btn-outline-light btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt mr-1"></i>Logout
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="dashboard-tab" data-toggle="tab" href="#dashboard" role="tab">
                    <i class="fas fa-home mr-2"></i>Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="new-request-tab" data-toggle="tab" href="#new-request" role="tab">
                    <i class="fas fa-plus-circle mr-2"></i>New Request
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="user-info-tab" data-toggle="tab" href="#user-info" role="tab">
                    <i class="fas fa-user mr-2"></i>User Info
                </a>
            </li>
            <li class="nav-item" id="admin-tab-item" style="display: none;">
                <a class="nav-link" id="admin-dashboard-tab" data-toggle="tab" href="#admin-dashboard" role="tab">
                    <i class="fas fa-chart-line mr-2"></i>Admin Dashboard
                </a>
            </li>
            <li class="nav-item" id="user-management-tab-item" style="display: none;">
                <a class="nav-link" id="user-management-tab" data-toggle="tab" href="#user-management" role="tab">
                    <i class="fas fa-users mr-2"></i>User Management
                </a>
            </li>
            <li class="nav-item" id="request-override-tab-item" style="display: none;">
                <a class="nav-link" id="request-override-tab" data-toggle="tab" href="#request-override" role="tab">
                    <i class="fas fa-edit mr-2"></i>Request Status Override
                </a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row mb-2">
                    <div class="col">
                        <h5>Request Dashboard</h5>
                    </div>
                    <div class="col-auto d-flex align-items-center">
                        <div class="auto-refresh-controls mr-3">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="autoRefreshToggle" checked>
                                <label class="form-check-label" for="autoRefreshToggle">
                                    Auto-refresh
                                </label>
                            </div>
                            <span class="auto-refresh-timer" id="autoRefreshTimer">30s</span>
                        </div>
                        <button class="btn btn-success btn-sm" onclick="refreshRequests()">
                            <i class="fas fa-sync-alt mr-1"></i>Refresh
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="row mb-3">
                    <div class="col-md-2-4">
                        <div class="card bg-info text-white kpi-card" onclick="filterRequestsByStatus('all')" style="cursor: pointer; transition: transform 0.2s;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="mb-0" id="total-requests">0</h4>
                                        <p class="mb-0">Total Requests</p>
                                    </div>
                                    <i class="fas fa-clipboard-list fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2-4">
                        <div class="card bg-warning text-white kpi-card" onclick="filterRequestsByStatus('submitted')" style="cursor: pointer; transition: transform 0.2s;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="mb-0" id="submitted-requests">0</h4>
                                        <p class="mb-0">Submitted</p>
                                    </div>
                                    <i class="fas fa-clock fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2-4">
                        <div class="card bg-primary text-white kpi-card" onclick="filterRequestsByStatus('processing')" style="cursor: pointer; transition: transform 0.2s;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="mb-0" id="processing-requests">0</h4>
                                        <p class="mb-0">Processing</p>
                                    </div>
                                    <i class="fas fa-cog fa-2x fa-spin"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2-4">
                        <div class="card bg-success text-white kpi-card" onclick="filterRequestsByStatus('completed')" style="cursor: pointer; transition: transform 0.2s;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="mb-0" id="completed-requests">0</h4>
                                        <p class="mb-0">Completed</p>
                                    </div>
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2-4">
                        <div class="card bg-danger text-white kpi-card" onclick="filterRequestsByStatus('failed')" style="cursor: pointer; transition: transform 0.2s;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 class="mb-0" id="failed-requests">0</h4>
                                        <p class="mb-0">Failed</p>
                                    </div>
                                    <i class="fas fa-times-circle fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Status Indicator -->
                <div class="row mb-2">
                    <div class="col-12">
                        <div id="filter-status" class="alert alert-info" style="display: none;">
                            <i class="fas fa-filter mr-2"></i>
                            <span id="filter-text">Showing all requests</span>
                            <button type="button" class="btn btn-sm btn-outline-info ml-2" onclick="clearFilter()">
                                <i class="fas fa-times mr-1"></i>Clear Filter
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Requests Table -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0" id="requests-card-title">All Requests</h5>
                        <div class="d-flex align-items-center">
                            <input type="text" class="form-control form-control-sm mr-2" id="searchRequests" placeholder="Search requests..." style="width: 180px;">
                            <input type="date" class="form-control form-control-sm mr-2" id="dateFilter" placeholder="Filter by date" style="width: 140px;">
                            <select class="form-control form-control-sm" id="statusFilter" style="width: 120px;">
                                <option value="">All Status</option>
                                <option value="submitted">Submitted</option>
                                <option value="processing">Processing</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="requestsTable">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Request #</th>
                                        <th>Requester's Name</th>
                                        <th>Request Date/Time</th>
                                        <th>Status</th>
                                        <th>Pipeline</th>
                                        <th>Category</th>
                                        <th>Amount</th>
                                        <th>Adjustment</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody id="requestsTableBody">
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div id="noResultsMessage" class="text-center text-muted py-4" style="display: none;">
                            <i class="fas fa-search fa-2x mb-2"></i>
                            <p>No requests found matching your search criteria.</p>
                        </div>

                        <!-- Pagination Controls -->
                        <div class="d-flex justify-content-between align-items-center mt-3" id="paginationContainer" style="display: none;">
                            <div class="text-muted">
                                <span id="paginationInfo">Showing 1 to 10 of 100 results</span>
                            </div>
                            <nav aria-label="Requests pagination">
                                <ul class="pagination pagination-sm mb-0" id="paginationControls">
                                    <li class="page-item" id="prevPage">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    <!-- Page numbers will be dynamically generated -->
                                    <li class="page-item" id="nextPage">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Request Tab -->
            <div class="tab-pane fade" id="new-request" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-plus-circle mr-2"></i>Create New Request</h5>
                            </div>
                            <div class="card-body">
                                <form id="newRequestForm">
                                    <!-- Requester Details Section -->
                                    <div class="form-section mb-4">
                                        <h6 class="form-section-title">Requester Details</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="requestorName">Requestor Name</label>
                                                    <input type="text" class="form-control" id="requestorName" name="requestorName" readonly style="background-color: #f8f9fa;">
                                                    <small class="form-text text-muted">Pre-filled from your user profile.</small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="requestorEmail">Requestor Email</label>
                                                    <input type="email" class="form-control" id="requestorEmail" name="requestorEmail" readonly style="background-color: #f8f9fa;">
                                                    <small class="form-text text-muted">Pre-filled from your user profile.</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="ccEmail">CC Email</label>
                                                    <input type="email" class="form-control" id="ccEmail" name="ccEmail">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="teamName">Team Name</label>
                                                    <input type="text" class="form-control" id="teamName" name="teamName" readonly style="background-color: #f8f9fa;">
                                                    <small class="form-text text-muted">Pre-filled from your user profile.</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Request Details Section -->
                                    <div class="form-section mb-4">
                                        <h6 class="form-section-title">Request Details</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="categoryName">Category Name <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="categoryName" name="categoryName" required>
                                                        <option value="">Select Category</option>
                                                        <option value="val1">Value 1</option>
                                                        <option value="val2">Value 2</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="requestDates">Date <span class="text-danger">*</span></label>
                                                    <div class="mb-2">
                                                        <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                                            <label class="btn btn-outline-secondary btn-sm active">
                                                                <input type="radio" name="dateInputType" id="calendarOption" value="calendar" checked> Calendar
                                                            </label>
                                                            <label class="btn btn-outline-secondary btn-sm">
                                                                <input type="radio" name="dateInputType" id="rangeOption" value="range"> Range
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <input type="text" class="form-control" id="requestDates" name="requestDates" placeholder="Select multiple dates" required>

                                                    <!-- Enhanced Date Range UI -->
                                                    <div id="dateRangeContainer" style="display: none;">
                                                        <div id="dateRangesList"></div>
                                                        <button type="button" class="btn btn-outline-primary btn-sm mt-1" id="addDateRangeBtn">
                                                            <i class="fas fa-plus mr-1"></i>Add Range
                                                        </button>
                                                        <small class="form-text text-muted mt-1">
                                                            Add date ranges to include all dates between start and end.
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="adjustment">Adjustment <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="adjustment" name="adjustment" required>
                                                        <option value="">Select Adjustment</option>
                                                        <option value="0">0</option>
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5">5</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="acctNumber">Account Number <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="acctNumber" name="acctNumber" required>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="requestName">Name <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="requestName" name="requestName" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="currency">Currency <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="currency" name="currency" required>
                                                        <option value="">Select Currency</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="amount">Amount <span class="text-danger">*</span></label>
                                                    <input type="number" class="form-control" id="amount" name="amount" step="0.01" min="0" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <!-- Empty column for layout balance -->
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="description">Description</label>
                                            <textarea class="form-control" id="description" name="description" rows="4" placeholder="Enter request description" maxlength="500"></textarea>
                                            <small class="form-text text-muted">
                                                <span id="descriptionCount">0</span>/500 characters
                                            </small>
                                        </div>
                                    </div>

                                    <!-- Form Buttons -->
                                    <div class="text-center">
                                        <button type="submit" class="btn btn-primary btn-lg mr-3">
                                            <i class="fas fa-paper-plane mr-2"></i>Submit Request
                                        </button>
                                        <button type="reset" class="btn btn-secondary btn-lg">
                                            <i class="fas fa-undo mr-2"></i>Reset
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Info Tab -->
            <div class="tab-pane fade" id="user-info" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-user mr-2"></i>User Information</h5>
                            </div>
                            <div class="card-body">
                                <form id="userInfoForm">
                                    <div class="form-group">
                                        <label for="userFullName">Full Name</label>
                                        <input type="text" class="form-control" id="userFullName" name="userFullName" readonly style="background-color: #f8f9fa;">
                                        <small class="form-text text-muted">This information is from your registration and cannot be edited.</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="userName">Username</label>
                                        <input type="text" class="form-control" id="userName" name="userName" readonly style="background-color: #f8f9fa;">
                                        <small class="form-text text-muted">This information is from your registration and cannot be edited.</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="userEmail">Email</label>
                                        <input type="email" class="form-control" id="userEmail" name="userEmail" readonly style="background-color: #f8f9fa;">
                                        <small class="form-text text-muted">This information is from your registration and cannot be edited.</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="userTeam">Team</label>
                                        <input type="text" class="form-control" id="userTeam" name="userTeam" readonly style="background-color: #f8f9fa;">
                                        <small class="form-text text-muted">This information is from your registration and cannot be edited.</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="userDescription">Description</label>
                                        <textarea class="form-control" id="userDescription" name="description" rows="4" placeholder="Enter description" maxlength="300"></textarea>
                                        <small class="form-text text-muted">
                                            <span id="userDescriptionCount">0</span>/300 characters
                                        </small>
                                    </div>
                                    <div class="text-center">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-save mr-2"></i>Save User Info
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Dashboard Tab -->
            <div class="tab-pane fade" id="admin-dashboard" role="tabpanel">
                <div class="row mb-3">
                    <div class="col">
                        <h5><i class="fas fa-chart-line mr-2"></i>Admin Analytics Dashboard</h5>
                        <p class="text-muted">Comprehensive analytics across all 3 database tables</p>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-primary btn-sm" onclick="refreshAdminDashboard()">
                            <i class="fas fa-sync-alt mr-1"></i>Refresh Data
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card border-primary h-100">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-users mr-2"></i>Users Overview</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <h3 class="text-primary mb-0" id="admin-total-users">0</h3>
                                        <small class="text-muted">Total Users</small>
                                    </div>
                                    <div class="col-6">
                                        <h3 class="text-info mb-0" id="admin-daily-active">0</h3>
                                        <small class="text-muted">Daily Active</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card border-success h-100">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-clipboard-list mr-2"></i>Requests Overview</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <h3 class="text-success mb-0" id="admin-total-requests">0</h3>
                                        <small class="text-muted">Total Requests</small>
                                    </div>
                                    <div class="col-6">
                                        <h3 class="text-warning mb-0" id="admin-daily-requests">0</h3>
                                        <small class="text-muted">Today</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card border-warning h-100">
                            <div class="card-header bg-warning text-white">
                                <h6 class="mb-0"><i class="fas fa-chart-pie mr-2"></i>Status Distribution</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <h3 class="text-success mb-0" id="admin-completed-rate">0%</h3>
                                        <small class="text-muted">Completed</small>
                                    </div>
                                    <div class="col-6">
                                        <h3 class="text-danger mb-0" id="admin-failed-rate">0%</h3>
                                        <small class="text-muted">Failed</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card border-info h-100">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-history mr-2"></i>Status Changes</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <h3 class="text-info mb-0" id="admin-total-status-changes">0</h3>
                                        <small class="text-muted">Total Changes</small>
                                    </div>
                                    <div class="col-6">
                                        <h3 class="text-secondary mb-0" id="admin-recent-changes">0</h3>
                                        <small class="text-muted">Last 24h</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Analytics -->
                <div class="row">
                    <!-- Users Table Analysis -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-users mr-2"></i>Users Table Breakdown</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="max-height: 300px;">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Team</th>
                                                <th>Users</th>
                                                <th>Total Requests</th>
                                                <th>Active Users</th>
                                            </tr>
                                        </thead>
                                        <tbody id="admin-users-breakdown">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Requests Table Analysis -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-clipboard-list mr-2"></i>Requests Table Breakdown</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="max-height: 300px;">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Status</th>
                                                <th>Count</th>
                                                <th>Percentage</th>
                                                <th>Avg Days</th>
                                            </tr>
                                        </thead>
                                        <tbody id="admin-requests-breakdown">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Status History Analysis -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-history mr-2"></i>Status History Analysis</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="max-height: 300px;">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Status Change</th>
                                                <th>Count</th>
                                                <th>Last Change</th>
                                                <th>Most Active User</th>
                                            </tr>
                                        </thead>
                                        <tbody id="admin-history-breakdown">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-clock mr-2"></i>Recent Activity (Last 10)</h6>
                            </div>
                            <div class="card-body">
                                <div class="timeline" style="max-height: 300px; overflow-y: auto;" id="admin-recent-activity">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Trends Chart -->
                <div class="row">
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-chart-line mr-2"></i><span id="trends-title">Monthly Trends</span></h6>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary active" id="monthly-trends-btn" onclick="switchTrendsPeriod('monthly')">Monthly</button>
                                    <button type="button" class="btn btn-outline-primary" id="daily-trends-btn" onclick="switchTrendsPeriod('daily')">Daily</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="admin-trends-chart" width="400" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Tab -->
            <div class="tab-pane fade" id="user-management" role="tabpanel">
                <div class="row mb-3">
                    <div class="col">
                        <h5><i class="fas fa-users mr-2"></i>User Management</h5>
                        <p class="text-muted">Manage user accounts, approvals, and permissions</p>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-primary btn-sm" onclick="refreshUserManagement()">
                            <i class="fas fa-sync-alt mr-1"></i>Refresh
                        </button>
                    </div>
                </div>

                <!-- User Statistics Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-users mr-2"></i>Total Users</h6>
                            </div>
                            <div class="card-body">
                                <h3 class="text-info mb-0" id="total-users-count">0</h3>
                                <small class="text-muted">Registered Users</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-white">
                                <h6 class="mb-0"><i class="fas fa-clock mr-2"></i>Pending Approval</h6>
                            </div>
                            <div class="card-body">
                                <h3 class="text-warning mb-0" id="pending-users-count">0</h3>
                                <small class="text-muted">Awaiting Review</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-check mr-2"></i>Approved Users</h6>
                            </div>
                            <div class="card-body">
                                <h3 class="text-success mb-0" id="approved-users-count">0</h3>
                                <small class="text-muted">Active Users</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <h6 class="mb-0"><i class="fas fa-user-slash mr-2"></i>Disabled Users</h6>
                            </div>
                            <div class="card-body">
                                <h3 class="text-danger mb-0" id="disabled-users-count">0</h3>
                                <small class="text-muted">Inactive Users</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Table -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">All Users</h5>
                        <div class="d-flex align-items-center">
                            <select class="form-control form-control-sm mr-2" id="userStatusFilter" style="width: 150px;">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="disabled">Disabled</option>
                            </select>
                            <input type="text" class="form-control form-control-sm" id="searchUsers" placeholder="Search users..." style="width: 200px;">
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="usersTable">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Team</th>
                                        <th>Status</th>
                                        <th>Role</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div id="noUsersMessage" class="text-center text-muted py-4" style="display: none;">
                            <i class="fas fa-search fa-2x mb-2"></i>
                            <p>No users found matching your criteria.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Request Status Override Tab -->
            <div class="tab-pane fade" id="request-override" role="tabpanel">
                <div class="row mb-3">
                    <div class="col">
                        <h5><i class="fas fa-edit mr-2"></i>Request Status Override</h5>
                        <p class="text-muted">Override request status and manage failure messages</p>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-primary btn-sm" onclick="refreshRequestOverride()">
                            <i class="fas fa-sync-alt mr-1"></i>Refresh
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                            </div>
                            <input type="text" class="form-control" id="requestOverrideSearch" placeholder="Search requests..." onkeyup="filterRequestOverride()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-control" id="statusFilterOverride" onchange="filterRequestOverride()">
                            <option value="all">All Statuses</option>
                            <option value="submitted">Submitted</option>
                            <option value="processing">Processing</option>
                            <option value="failed">Failed</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>

                <!-- Requests Table -->
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="fas fa-list mr-2"></i>All Requests - Status Management</h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                            <table class="table table-striped table-hover mb-0" id="requestOverrideTable">
                                <thead class="thead-light sticky-top">
                                    <tr>
                                        <th>Request ID</th>
                                        <th>Requester</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Current Status</th>
                                        <th>Created Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="requestOverrideTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted py-3">
                                            <i class="fas fa-spinner fa-spin mr-2"></i>Loading requests...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Override Modal -->
    <div class="modal fade" id="statusOverrideModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Request Status</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Request ID</label>
                        <input type="text" class="form-control" id="overrideRequestId" readonly>
                    </div>
                    <div class="form-group">
                        <label>Current Status</label>
                        <input type="text" class="form-control" id="overrideCurrentStatus" readonly>
                    </div>
                    <div class="form-group">
                        <label>New Status <span class="text-danger">*</span></label>
                        <select class="form-control" id="overrideNewStatus" onchange="toggleFailureMessage()">
                            <option value="">Select Status</option>
                            <option value="submitted">Submitted</option>
                            <option value="processing">Processing</option>
                            <option value="failed">Failed</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="form-group" id="failureMessageGroup">
                        <label>Admin Comments</label>
                        <textarea class="form-control" id="overrideFailureMessage" rows="3" placeholder="Optional comments for this status change..."></textarea>
                        <small class="form-text text-muted">These comments will be shown to users when they hover over the status badge.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateRequestStatus()">Update Status</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages Modal -->
    <div class="modal fade" id="messageModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header" id="messageModalHeader">
                    <h5 class="modal-title" id="messageModalTitle"></h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="messageModalBody">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-2">Processing request...</p>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="js/dashboard-final.js"></script>
</body>
</html>